# Echo of You - MVP仕様書

## 1. 概要

### 1.1 プロジェクト概要
- **タイトル**: Echo of You (EOY)
- **ジャンル**: ビジュアルノベル / 心理サスペンス
- **エンジン**: Ren'Py 8.x
- **開発フェーズ**: MVP (Minimum Viable Product)
- **物語構成**: 上編・中編・下編の三部構成

### 1.2 MVP範囲（改訂版）
MVPでは以下の**コアシステム**の実装に集中する：
- **情報収集システム**（上編・下編共通）
- **サイドバーUI**（常時アクセス可能）
- **フローチャート画面**（進行状況の可視化）
- **情報閲覧画面**（収集情報の確認）

物語の詳細な実装は後回しとし、システムの動作検証を優先する。

## 2. 機能要件（MVP版）

### 2.1 サイドバーUI

#### 2.1.1 構成
```
ゲーム画面右側に常時表示される縦型バー
┌────┐
│ 📊 │ → フローチャート
├────┤
│ 📝 │ → 情報タブ
├────┤
│ 💾 │ → セーブ
├────┤
│ 📂 │ → ロード
├────┤
│ ⚙️ │ → 設定
└────┘
```

#### 2.1.2 機能
- **常時表示**: ゲームプレイ中は常に画面右端に表示
- **ワンクリックアクセス**: 各機能へ即座にアクセス可能
- **非侵襲的**: メインゲーム画面を邪魔しない最小限のデザイン
- **ホバーエフェクト**: マウスオーバーで機能名を表示
- **開閉アニメーション**: 画面を滑らかに切り替え

### 2.2 情報収集システム

#### 2.2.1 基本仕様
- **トリガー**: 会話中の選択肢や調査アクションで情報獲得
- **情報タイプ**:
  - **必須情報**: ストーリー進行に必要（各キャラ3〜5個）
  - **サブ情報**: 世界観理解を深める補足情報
- **獲得通知**: 新情報獲得時にポップアップ表示
- **進捗管理**: 各キャラクターの情報収集率を表示

#### 2.2.2 情報構造
```python
information = {
    "character_name": {
        "essential": {
            "info1": {"name": "悩み", "content": "", "unlocked": False},
            "info2": {"name": "好物", "content": "", "unlocked": False},
            "info3": {"name": "思い出", "content": "", "unlocked": False}
        },
        "sub": {
            "sub1": {"name": "趣味", "content": "", "unlocked": False},
            "sub2": {"name": "秘密", "content": "", "unlocked": False}
        }
    }
}
```

### 2.3 フローチャート画面

#### 2.3.1 表示要素
- **ノード**: 各シーンを表す円形/四角形のアイコン
- **接続線**: シーン間の繋がりを示すライン
- **現在位置**: プレイヤーの現在地を強調表示
- **進行状況**: 訪問済み（色付き）、未訪問（グレー）、ロック（暗転）

#### 2.3.2 インタラクション
- **ズーム**: マウスホイールで拡大縮小
- **パン**: ドラッグで画面移動
- **ノード選択**: クリックで詳細情報表示
- **ジャンプ**: 訪問済みノードへの即座移動（確認ダイアログ付き）

### 2.4 情報閲覧画面

#### 2.4.1 レイアウト
```
┌─────────────────────────────────────┐
│ 情報タブ                    [×]     │
├─────────────────────────────────────┤
│ [キャラ選択タブ]                    │
│ [キョウコ][ホノカ][ルナ][少女]     │
├─────────────────────────────────────┤
│ ■必須情報 (2/3)                    │
│ ✓ 悩み: 成績のプレッシャー         │
│ ✓ 好物: いちごケーキ               │
│ ○ 思い出: [未解禁]                 │
│                                     │
│ ■サブ情報 (1/2)                    │
│ ✓ 趣味: 読書                       │
│ ○ 秘密: [未解禁]                   │
│                                     │
│ 収集率: 60%                         │
│ ▓▓▓▓▓▓░░░░                        │
└─────────────────────────────────────┘
```

#### 2.4.2 機能
- **タブ切り替え**: キャラクター別に情報を整理
- **進捗表示**: 視覚的な収集率バー
- **詳細表示**: 解禁済み情報の内容確認
- **ソート機能**: 取得順/種類別で並び替え

## 3. 画面仕様

### 3.1 メインゲーム画面（サイドバー付き）
```
┌────────────────────────────────────────┬────┐
│                                        │ 📊 │
│         背景画像                       ├────┤
│                                        │ 📝 │
│    キャラクター立ち絵                  ├────┤
│                                        │ 💾 │
│                                        ├────┤
├────────────────────────────────────────┤ 📂 │
│ 名前                                   ├────┤
├────────────────────────────────────────┤ ⚙️ │
│ テキスト表示エリア                     │    │
│                                        │    │
└────────────────────────────────────────┴────┘
```

### 3.2 情報獲得時のポップアップ
```
┌─────────────────────────┐
│  ✨ 新しい情報を獲得！  │
├─────────────────────────┤
│  キョウコの「悩み」     │
│  成績のプレッシャー     │
└─────────────────────────┘
（3秒後に自動で消える）
```

## 4. データ構造

### 4.1 セーブデータ
```python
# 進行状況
segment = ""          # 現在のセグメント
segments = []         # 訪問済みセグメント
endings = []          # 達成エンディング

# キャラクター攻略状況
conquered_chars = []  # 攻略済みキャラ
current_target = ""   # 現在の攻略対象

# 情報収集
collected_info = {
    "kyoko": {"worry": False, "favorite": False, "memory": False},
    "honoka": {"worry": False, "favorite": False, "memory": False},
    "luna": {"worry": False, "favorite": False, "memory": False},
    "shoujo": {"info1": False, "info2": False, "info3": False, "info4": False, "info5": False}
}

# ストーリーフラグ
story_flags = {
    "volume1_complete": False,
    "volume2_unlocked": False,
    "volume3_unlocked": False,
    "truth_revealed": False
}
```

### 4.2 フローチャートノード定義
```python
nodes = {
    # 上編
    "vol1_start": [(100, 100), "上編開始", "偽ユウによる攻略開始", "True"],
    "vol1_kyoko": [(200, 200), "キョウコルート", "キョウコ攻略", "True"],
    "vol1_honoka": [(200, 300), "ホノカルート", "ホノカ攻略", "True"],
    "vol1_luna": [(200, 400), "ルナルート", "ルナ攻略", "True"],
    "vol1_epilogue": [(300, 250), "上編エピローグ", "偽ユウと少女の会話", "'vol1_complete' in story_flags"],
    
    # 中編
    "vol2_start": [(400, 250), "中編開始", "本物ユウ視点", "'vol1_complete' in story_flags"],
    "vol2_tragedy": [(500, 250), "悲劇", "3人の死", "'vol2_start' in segments"],
    
    # 下編
    "vol3_start": [(600, 250), "下編開始", "少女攻略", "'vol2_tragedy' in segments"],
    "vol3_truth": [(700, 250), "真実", "全ての真相", "'shoujo' in conquered_chars"],
    "vol3_ending": [(800, 250), "終幕", "P.mem停止", "'vol3_truth' in segments"]
}
```

## 5. 実装優先順位（改訂版）

### Phase 1: 基盤構築（最優先）
1. Ren'Pyプロジェクト初期化
2. サイドバーUI実装
3. 基本的な画面遷移システム

### Phase 2: 情報システム実装（必須）
1. 情報収集システムの基本実装
2. 情報閲覧画面の実装
3. 情報獲得ポップアップ
4. データ永続化（セーブ/ロード）

### Phase 3: フローチャート実装（必須）
1. フローチャートプラグイン統合
2. ノード定義（簡易版）
3. フローチャート画面からのジャンプ機能

### Phase 4: デモシナリオ（検証用）
1. テスト用の短いシナリオ作成
2. 情報収集の動作確認
3. システム全体の統合テスト

## 6. テスト項目（MVP版）

### 6.1 サイドバーUI
- [ ] サイドバー常時表示
- [ ] 各ボタンのホバーエフェクト
- [ ] フローチャート画面への遷移
- [ ] 情報タブ画面への遷移
- [ ] セーブ/ロード画面への遷移

### 6.2 情報収集システム
- [ ] 選択肢による情報獲得
- [ ] 情報獲得ポップアップ表示
- [ ] 情報タブでの閲覧
- [ ] キャラクター別タブ切り替え
- [ ] 収集率の正確な計算
- [ ] セーブ/ロード後の情報保持

### 6.3 フローチャート
- [ ] ノードの表示
- [ ] 現在位置の強調表示
- [ ] 訪問済み/未訪問の区別
- [ ] ノード選択時の詳細表示
- [ ] ジャンプ機能（確認ダイアログ付き）

## 7. 必要リソース（MVP用仮素材）

### 7.1 画像
- **背景**: 学校、教室、屋上、街、暗い空間（各1枚）
- **キャラクター**: 立ち絵なし（名前表示のみ）でもOK
- **UI素材**: ボタン、ウィンドウ枠（Ren'Pyデフォルト使用可）
- **フローチャート**: 
  - ground.png（ベース）
  - idle.png, hover.png, selected_idle.png, selected_hover.png, insensitive.png
  - crosshair.png（現在位置マーカー）

### 7.2 テキスト
- **シナリオ**: 各編の最小限のテキスト（概要レベル）
- **システムメッセージ**: エラー、確認ダイアログ

### 7.3 音声（オプション）
- **BGM**: フリー素材で最小限
- **SE**: クリック音、決定音（Ren'Pyデフォルト）

## 8. 開発スケジュール（目安）

```
Day 1-2: Phase 1 - 基盤構築
Day 3-4: Phase 2 - 上編実装  
Day 5-6: Phase 3 - 中編・下編実装
Day 7: Phase 4 - テスト・調整
```

## 9. 成功基準

### 必須要件
- ゲームが最初から最後まで通してプレイできる
- 上編の全員攻略システムが機能する
- フローチャートでゲーム進行が視覚化される
- セーブ/ロードが正常に動作する

### 推奨要件
- フローチャートからのジャンプが可能
- 情報収集の進捗が確認できる
- 基本的なUIが整っている

## 10. 注意事項

- フローチャートプラグインの制約により、エンディング後は必ずゲーム内でループする設計とする
- 画像素材は後から差し替え可能な構造にする
- シナリオテキストは外部ファイル化して編集しやすくする
- デバッグモードを用意して開発効率を上げる

## 11. ファイル構成（MVP版）

```
echo-of-you/
├── game/
│   ├── script.rpy           # メインスクリプト
│   ├── options.rpy          # ゲーム設定
│   ├── gui.rpy              # GUI設定
│   ├── screens.rpy          # 画面定義（サイドバーUI含む）
│   ├── sidebar.rpy          # サイドバー専用定義
│   ├── information.rpy      # 情報収集システム
│   ├── flowchart/           # フローチャートプラグイン
│   │   ├── flowchart.rpy
│   │   └── image/
│   │       ├── ground.png
│   │       ├── idle.png
│   │       ├── hover.png
│   │       └── ...
│   ├── demo/                # デモシナリオ
│   │   └── test_scenario.rpy
│   └── images/              # 画像素材
│       ├── bg/
│       └── ui/
├── FlowchartStandalone/     # プラグイン元ファイル
└── FlowchartTool-1.0-pc/    # プラグインツール
```

## 12. 実装のポイント

### 12.1 サイドバーの実装
```python
screen sidebar():
    frame:
        xalign 1.0
        yalign 0.5
        xsize 60
        
        vbox:
            imagebutton:
                idle "ui/flowchart_icon.png"
                hover "ui/flowchart_icon_hover.png"
                action ShowMenu("flowchart")
                tooltip "フローチャート"
            
            imagebutton:
                idle "ui/info_icon.png"
                hover "ui/info_icon_hover.png"
                action ShowMenu("information")
                tooltip "情報タブ"
```

### 12.2 情報収集の実装
```python
# 情報獲得時の処理
def unlock_info(character, info_type, info_key):
    global collected_info
    collected_info[character][info_type][info_key] = True
    renpy.show_screen("info_popup", character, info_key)
    renpy.pause(3.0, hard=True)
    renpy.hide_screen("info_popup")
```

---

このMVP仕様書に基づいて、Echo of Youの核となる体験を実装します。